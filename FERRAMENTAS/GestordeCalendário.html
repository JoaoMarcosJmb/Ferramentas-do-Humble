<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerador Visual Humble League</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #1e293b;
            color: white;
            display: flex;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* --- BARRA LATERAL (CONTROLES) --- */
        .sidebar {
            width: 350px;
            background: #0f172a;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-right: 1px solid #334155;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            z-index: 10;
        }

        h2 { color: #fbbf24; margin: 0 0 10px 0; font-size: 20px; }
        label { font-size: 14px; color: #94a3b8; margin-bottom: 5px; display: block; }
        
        input, select, textarea {
            width: 100%;
            background: #1e293b;
            border: 1px solid #334155;
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            box-sizing: border-box;
            font-family: monospace;
        }

        textarea { height: 200px; resize: vertical; }

        .btn {
            background: #8B1D1D;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn:hover { background: #a32424; }
        .btn-green { background: #16a34a; }
        .btn-green:hover { background: #15803d; }

        /* --- √ÅREA DE VISUALIZA√á√ÉO --- */
        .preview-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #334155; /* Cor de fundo da √°rea de trabalho */
            padding: 20px;
            overflow: auto;
        }

        /* O CONTAINER DA ARTE */
        #art-container {
            position: relative;
            width: 1000px;  /* Largura fixa para garantir qualidade */
            height: 1000px; /* Altura fixa (quadrado) */
            background-color: #fff;
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            /* Fonte global da arte */
            font-family: 'Fredoka', sans-serif; 
            font-weight: 600;
        }

        /* T√çTULO DO M√äS (Overlay) */
        #overlay-title {
            position: absolute;
            top: 4%;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 60px;
            color: #E25D33; /* Cor laranja do exemplo */
            text-transform: uppercase;
            text-shadow: 3px 3px 0px #3e1b1b; /* Sombra cartunesca */
            pointer-events: none;
        }

        /* GRID DOS DIAS (Overlay) */
        /* Ajustado "no olho" para bater com as pedras da imagem enviada */
        .calendar-grid {
            position: absolute;
            top: 39%;     /* Onde come√ßam as pedras */
            left: 6%;     /* Margem esquerda */
            width: 89%;   /* Largura total das pedras */
            height: 52%;  /* Altura total das pedras */
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 1%;
        }

        .day-cell {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding-top: 10px;
            text-align: center;
            /* Debug: descomente para ver as caixas */
            /* border: 1px solid red; */
        }

        /* N√∫mero do dia */
        .day-num {
            position: absolute;
            bottom: 5px;
            left: 10px;
            font-size: 24px;
            color: #5c4033; /* Marrom escuro */
        }

        /* Texto do evento */
        .day-text {
            font-size: 15px;
            color: #5c4033;
            line-height: 1.1;
            margin-top: 5px;
            width: 90%;
            word-wrap: break-word;
        }

        /* CABE√áALHO DOS DIAS DA SEMANA (Hor√°rios) */
        .week-header {
            position: absolute;
            top: 32%;
            left: 6%;
            width: 89%;
            display: flex;
            justify-content: space-between;
            color: #d97706;
            font-size: 20px;
            font-weight: bold;
        }
        .week-col {
            width: 14%;
            text-align: center;
        }
        .time-label {
            display: block;
            font-size: 16px;
            color: #8B1D1D;
            margin-bottom: 2px;
        }

    </style>
</head>
<body>

    <div class="sidebar">
        <h2>üõ†Ô∏è Configurador</h2>

        <div>
            <label>1. Carregue a Imagem de Fundo</label>
            <input type="file" id="bgInput" accept="image/*">
        </div>

        <div style="display:flex; gap:10px;">
            <div style="flex:1">
                <label>M√™s (Nome)</label>
                <input type="text" id="mesNome" value="JANEIRO" oninput="atualizarArte()">
            </div>
            <div style="flex:1">
                <label>Ano</label>
                <input type="number" id="anoNum" value="2025" onchange="gerarGrid()">
            </div>
        </div>

        <div>
            <label>M√™s (N√∫mero para c√°lculo)</label>
            <select id="mesNum" onchange="gerarGrid()">
                <option value="0">Janeiro</option>
                <option value="1">Fevereiro</option>
                <option value="2">Mar√ßo</option>
                <option value="3">Abril</option>
                <option value="4">Maio</option>
                <option value="5">Junho</option>
                <option value="6">Julho</option>
                <option value="7">Agosto</option>
                <option value="8">Setembro</option>
                <option value="9">Outubro</option>
                <option value="10">Novembro</option>
                <option value="11">Dezembro</option>
            </select>
        </div>

        <div>
            <label>üìù Lista de Eventos (Importar)</label>
            <div style="font-size: 11px; color: #ccc; margin-bottom: 5px;">
                Formato: <b>Dia: Evento</b> (Um por linha)
            </div>
            <textarea id="eventInput" placeholder="1: Final Humble League&#10;4: Qualify UU&#10;12: Semanal OU...">1: Final Humble League
4: Qualify UU
12: Semanal OU
25: Qualify RU</textarea>
            <button class="btn" style="margin-top:5px; width:100%;" onclick="processarEventos()">üîÑ Atualizar Eventos</button>
        </div>

        <div style="margin-top: auto;">
            <button class="btn btn-green" style="width:100%;" onclick="baixarImagem()">üì∏ Baixar Arte Final</button>
        </div>
    </div>

    <div class="preview-area">
        <div id="art-container">
            <div id="overlay-title">JANEIRO</div>

            <div class="week-header">
                <div class="week-col"><span class="time-label">18h</span>Domingo</div>
                <div class="week-col"><span class="time-label">19h</span>Segunda</div>
                <div class="week-col"><span class="time-label">19h</span>Ter√ßa</div>
                <div class="week-col"><span class="time-label">19h</span>Quarta</div>
                <div class="week-col"><span class="time-label">19h</span>Quinta</div>
                <div class="week-col"><span class="time-label">19h</span>Sexta</div>
                <div class="week-col"><span class="time-label">18h</span>S√°bado</div>
            </div>

            <div class="calendar-grid" id="grid-container">
                </div>
        </div>
    </div>

    <script>
        // --- 1. CARREGAR IMAGEM DE FUNDO ---
        const bgInput = document.getElementById('bgInput');
        const artContainer = document.getElementById('art-container');

        bgInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    artContainer.style.backgroundImage = `url(${event.target.result})`;
                }
                reader.readAsDataURL(file);
            }
        });

        // --- 2. ATUALIZAR T√çTULO ---
        function atualizarArte() {
            document.getElementById('overlay-title').innerText = document.getElementById('mesNome').value;
        }

        // --- 3. GERAR GRID MATEM√ÅTICO ---
        function gerarGrid() {
            const grid = document.getElementById('grid-container');
            grid.innerHTML = ""; // Limpa

            const mes = parseInt(document.getElementById('mesNum').value);
            const ano = parseInt(document.getElementById('anoNum').value);

            // Calcula dias
            const primeiroDiaSemana = new Date(ano, mes, 1).getDay(); // 0 = Dom
            const totalDias = new Date(ano, mes + 1, 0).getDate();

            // C√©lulas vazias antes do dia 1
            for (let i = 0; i < primeiroDiaSemana; i++) {
                const div = document.createElement('div');
                div.className = 'day-cell'; 
                grid.appendChild(div);
            }

            // Dias do m√™s
            for (let d = 1; d <= totalDias; d++) {
                const div = document.createElement('div');
                div.className = 'day-cell';
                div.id = `cell-${d}`; // ID para encontrar f√°cil depois
                
                div.innerHTML = `
                    <div class="day-text" id="text-${d}"></div>
                    <div class="day-num">${d}</div>
                `;
                grid.appendChild(div);
            }
            
            // Re-aplicar eventos se j√° tiverem sido escritos
            processarEventos();
        }

        // --- 4. PROCESSAR TEXTO (IMPORTAR) ---
        function processarEventos() {
            // 1. Limpa todos os textos atuais
            document.querySelectorAll('.day-text').forEach(el => el.innerText = '');

            // 2. Pega o valor do textarea
            const rawText = document.getElementById('eventInput').value;
            const lines = rawText.split('\n');

            // 3. Loop linha por linha
            lines.forEach(line => {
                // Regex simples: Procura numero no come√ßo, dois pontos, e o resto
                // Ex: "12: Evento Legal"
                const match = line.match(/^(\d+)\s*[:|-]\s*(.*)/);
                
                if (match) {
                    const dia = match[1];
                    const evento = match[2].trim();

                    // Acha a c√©lula e escreve
                    const targetDiv = document.getElementById(`text-${dia}`);
                    if (targetDiv) {
                        // Se j√° tem texto, adiciona quebra de linha
                        if (targetDiv.innerText !== "") {
                            targetDiv.innerHTML += "<br>" + evento;
                        } else {
                            targetDiv.innerText = evento;
                        }
                    }
                }
            });
        }

        // --- 5. BAIXAR IMAGEM ---
        function baixarImagem() {
            // Verifica se tem fundo carregado
            if (artContainer.style.backgroundImage === "") {
                alert("Por favor, carregue a imagem de fundo primeiro (Prancheta_1...jpg).");
                return;
            }

            html2canvas(document.getElementById('art-container'), {
                scale: 1, // Tamanho real (1000px)
                useCORS: true 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Calendario_Humble_League.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // Inicializa grid ao abrir
        window.onload = gerarGrid;

    </script>
</body>
</html>
