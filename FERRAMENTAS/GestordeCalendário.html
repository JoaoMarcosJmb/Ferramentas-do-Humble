<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Calendário - Humble League</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700&display=swap');

        body {
            background-color: #222;
            color: white;
            font-family: 'Fredoka', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        /* --- CONTROLES --- */
        .controls {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            border: 1px solid #444;
            max-width: 1080px;
            width: 100%;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label { font-size: 0.75rem; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        
        input, button {
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            font-family: inherit;
            font-size: 0.9rem;
        }

        input[type="text"], input[type="date"], input[type="time"] {
            border: 1px solid #555;
        }

        button {
            background-color: #ff7043;
            color: white;
            font-weight: bold;
            cursor: pointer;
            height: 100%;
            align-self: flex-end;
            margin-top: auto;
        }

        button:hover { background-color: #f4511e; }
        input[type="file"] { background: #444; color: white; cursor: pointer; }

        /* --- ÁREA DO CALENDÁRIO (1080x1080) --- */
        #calendar-canvas {
            width: 1080px;
            height: 1080px;
            position: relative;
            /* Cor de fundo padrão caso não carregue imagem */
            background-color: #fceeb5; 
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            flex-shrink: 0; /* Impede que o canvas encolha em telas pequenas */
        }

        /* --- LAYOUT DA GRADE --- */
        .week-header {
            position: absolute;
            top: 275px; 
            left: 65px;
            width: 950px;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            z-index: 5;
        }

        .weekday-name {
            color: #bf360c;
            font-size: 24px;
            font-weight: 700;
        }

        .grid-container {
            position: absolute;
            top: 315px;
            left: 65px;
            width: 950px;
            height: 650px;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(5, 1fr);
        }

        .day-cell {
            position: relative;
            background-color: transparent; /* TRANSPARÊNCIA AQUI */
        }

        /* Número do dia */
        .day-number {
            position: absolute;
            bottom: 8px;
            left: 12px;
            font-size: 28px;
            font-weight: 700;
            color: #5d4037;
            z-index: 5;
        }

        /* Eventos */
        .event-box {
            position: absolute;
            top: 8px;
            left: 6px;
            right: 6px;
            background-color: #fff8e1;
            border-left: 5px solid #ff7043;
            padding: 6px 8px;
            border-radius: 6px;
            box-shadow: 2px 2px 6px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .event-time {
            font-size: 13px;
            font-weight: 700;
            color: #666;
            display: block;
            margin-bottom: 2px;
        }

        .event-title {
            font-size: 15px;
            font-weight: 700;
            color: #333;
            line-height: 1.1;
        }

        /* Pedras da Grade */
        .grid-asset {
            position: absolute;
            width: 17px; /* Tamanho da pedra */
            height: 17px;
            pointer-events: none;
            z-index: 2;
        }

    </style>
</head>
<body>

    <div class="controls">
        <div class="control-group">
            <label>1. Fundo (Liso)</label>
            <input type="file" id="bgInput" accept="image/*">
        </div>
        
        <div style="border-left: 1px solid #555; height: 30px; margin: 0 10px;"></div>

        <div class="control-group">
            <label>Nome do Evento</label>
            <input type="text" id="evtName" placeholder="Ex: Qualify OU">
        </div>
        <div class="control-group">
            <label>Data</label>
            <input type="date" id="evtDate" value="2026-01-04">
        </div>
        <div class="control-group">
            <label>Horário</label>
            <input type="time" id="evtTime" value="18:00">
        </div>
        <button onclick="addEvent()">+ Adicionar</button>
        <button onclick="renderCalendar()" style="background-color: #555; margin-left: 10px;">Recarregar Grade</button>
    </div>

    <div id="calendar-canvas">
        
        <div class="week-header">
            <div class="weekday-name">Domingo</div>
            <div class="weekday-name">Segunda</div>
            <div class="weekday-name">Terça</div>
            <div class="weekday-name">Quarta</div>
            <div class="weekday-name">Quinta</div>
            <div class="weekday-name">Sexta</div>
            <div class="weekday-name">Sábado</div>
        </div>

        <div class="grid-container" id="gridContainer">
            </div>

    </div>

    <script>
        // --- CONFIGURAÇÃO ---
        const ASSET_PATH = '../IMAGENS/pedra.png'; // Caminho da pedra

        // Configuração de Aleatoriedade
        const CONFIG = {
            skipChance: 0.15, // 15% de chance de NÃO desenhar uma pedra (deixa falhas na grade)
            jitter: 8,        // Quantos pixels a pedra pode "tremer" para fora do alinhamento
            rotationMax: 25   // Rotação máxima em graus
        };

        // Dados Iniciais
        let events = [
            { title: 'Qualify UU', date: '2026-01-04', time: '18:00' },
            { title: 'Semanal RU', date: '2026-01-06', time: '19:00' },
            { title: 'Final League', date: '2026-01-10', time: '18:00' }
        ];

        const canvas = document.getElementById('calendar-canvas');
        const gridContainer = document.getElementById('gridContainer');

        // --- 1. UPLOAD DE FUNDO ---
        document.getElementById('bgInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(file){
                const reader = new FileReader();
                reader.onload = function(event) {
                    canvas.style.backgroundImage = `url(${event.target.result})`;
                }
                reader.readAsDataURL(file);
            }
        });

        // --- 2. RENDERIZAR CALENDÁRIO ---
        function renderCalendar() {
            gridContainer.innerHTML = ''; 
            
            // Define Mês/Ano (Janeiro 2026)
            const baseDate = new Date(2026, 0, 1); 
            
            const year = baseDate.getFullYear();
            const month = baseDate.getMonth();
            const firstDayIndex = new Date(year, month, 1).getDay();
            const lastDay = new Date(year, month + 1, 0).getDate();

            // Renderizar 35 Células (5 semanas)
            const totalCells = 35;

            for (let i = 0; i < totalCells; i++) {
                const dayNumber = i - firstDayIndex + 1;
                const cell = document.createElement('div');
                cell.className = 'day-cell';

                // Se for dia válido
                if (dayNumber > 0 && dayNumber <= lastDay) {
                    // Número
                    const num = document.createElement('div');
                    num.className = 'day-number';
                    num.innerText = dayNumber;
                    cell.appendChild(num);

                    // Buscar Eventos
                    const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(dayNumber).padStart(2,'0')}`;
                    const daysEvents = events.filter(e => e.date === dateKey);
                    
                    daysEvents.sort((a,b) => a.time.localeCompare(b.time));

                    daysEvents.forEach(evt => {
                        const box = document.createElement('div');
                        box.className = 'event-box';
                        box.innerHTML = `
                            <span class="event-time">${evt.time}</span>
                            <span class="event-title">${evt.title}</span>
                        `;
                        cell.appendChild(box);
                    });
                }
                gridContainer.appendChild(cell);
            }

            // Desenhar Grade Orgânica
            drawOrganicGrid();
        }

        // --- 3. DESENHAR GRADE COM "FALHAS" E TREMORES ---
        function drawOrganicGrid() {
            const rows = 5;
            const cols = 7;
            
            // Tamanho das células (baseado no container 950x650)
            const cellW = 135.7; 
            const cellH = 130;
            const assetSize = 32; // Mesmo valor do CSS

            // Função que desenha UMA pedra
            function tryPlaceStone(top, left) {
                // 1. Chance de pular (Aleatoriedade na quantidade)
                if (Math.random() < CONFIG.skipChance) {
                    return; // Não desenha nada aqui (cria um buraco na grade)
                }

                const img = document.createElement('img');
                img.src = ASSET_PATH;
                img.className = 'grid-asset';
                
                // 2. Cálculo de Tremor (Jitter) - Posição levemente errada
                const randomX = (Math.random() * CONFIG.jitter) - (CONFIG.jitter / 2);
                const randomY = (Math.random() * CONFIG.jitter) - (CONFIG.jitter / 2);

                // Centralizar e aplicar tremor
                img.style.top = (top - (assetSize/2) + randomY) + 'px';
                img.style.left = (left - (assetSize/2) + randomX) + 'px';
                
                // 3. Rotação Aleatória
                const rot = (Math.random() * (CONFIG.rotationMax * 2)) - CONFIG.rotationMax;
                img.style.transform = `rotate(${rot}deg)`;

                // Tratamento de erro (aviso no console)
                img.onerror = function() { console.warn("Pedra não encontrada em: " + ASSET_PATH); }

                gridContainer.appendChild(img);
            }

            // Loop para percorrer a grade
            for (let r = 0; r <= rows; r++) {
                for (let c = 0; c <= cols; c++) {
                    const y = r * cellH;
                    const x = c * cellW;

                    // A. Pedra no vértice (cruzamento das linhas)
                    tryPlaceStone(y, x);

                    // B. Pedra no meio da linha horizontal
                    if (c < cols) {
                        tryPlaceStone(y, x + (cellW/2));
                    }

                    // C. Pedra no meio da linha vertical
                    if (r < rows) {
                        tryPlaceStone(y + (cellH/2), x);
                    }
                }
            }
        }

        // --- 4. FUNÇÃO DE ADICIONAR EVENTO ---
        function addEvent() {
            const name = document.getElementById('evtName').value;
            const date = document.getElementById('evtDate').value;
            const time = document.getElementById('evtTime').value;

            if(!name || !date || !time) {
                alert("Preencha todos os dados do evento!");
                return;
            }

            events.push({ title: name, date: date, time: time });
            renderCalendar();
        }

        // Inicializa
        renderCalendar();

    </script>
</body>
</html>
